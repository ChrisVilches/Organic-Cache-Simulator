"use strict";var algoritmoReemplazo,tipoDireccion,cacheEstado;!function(t){t[t.LRU=0]="LRU",t[t.MRU=1]="MRU",t[t.RANDOM=2]="RANDOM"}(algoritmoReemplazo=algoritmoReemplazo||{}),function(t){t[t.BYTE=0]="BYTE",t[t.WORD=1]="WORD"}(tipoDireccion=tipoDireccion||{}),function(t){t[t.HIT=0]="HIT",t[t.MISS=1]="MISS"}(cacheEstado=cacheEstado||{});var transpiladorMips,blocksize,nblocks,nvias,algoritmo,tipoAsociatividad,addressing,cache,CacheSimulator=function(){function t(){}return Object.defineProperty(t.prototype,"hitCount",{get:function(){return this._cacheHitCuenta},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"missCount",{get:function(){return this._cacheMissCuenta},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hitRate",{get:function(){var t=this.hitCount+this.missCount,t=this.hitCount/t;return Math.round(1e4*t)/100},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"numSets",{get:function(){return this._nBlocks/this._setSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetTotal",{get:function(){return this._tipoDireccion==tipoDireccion.BYTE?4*this._blockSize:this._blockSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bitsOffset",{get:function(){return this.offsetTotal.toString(2).length-1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bitsIndice",{get:function(){return this.numSets.toString(2).length-1},enumerable:!1,configurable:!0}),t.prototype.configurar=function(t,e,o,i,r,n){this._blockSize=t,this._nBlocks=e,"lru"==i?this._algoritmoReemplazo=algoritmoReemplazo.LRU:"mru"==i?this._algoritmoReemplazo=algoritmoReemplazo.MRU:"random"==i&&(this._algoritmoReemplazo=algoritmoReemplazo.RANDOM),this._tipoDireccion="b"==n?tipoDireccion.BYTE:tipoDireccion.WORD,"md"==r?this._setSize=1:"sa"==r?this._setSize=o:"fa"==r&&(this._setSize=this._nBlocks)},t.prototype.procesarDirecciones=function(t){var e,o,i,r,n,a="",s=this.encontrarCantidadDeBitsNecesarias(t);for(this._cacheHitCuenta=0,this._cacheMissCuenta=0,r=new Array(this.numSets),e=0;e<this.numSets;e++)r[e]=new Array(this._setSize);for(e=0;e<this.numSets;e++)for(o=0;o<this._setSize;o++)r[e][o]=-1;for(a='<table class="tablaCacheHitMiss">',a+="<tr>",a+='<th class="noset"> </th>',a+='<th class="noset">#</th>',a+='<th class="noset">address</th>',a+='<th class="noset">binary<br/><small>(tag index offset)</small</th>',a+='<th class="noset">block #</th>',e=0;e<this.numSets;e++)a+="<th>set "+e+"</th>";for(a+="</tr>",e=0;e<t.length;e++)n=t[e],n=(i=Math.floor(n/this.offsetTotal))%this.numSets,n=this.bloqueEstaEnSet(r[n],i)?(this.correrBloqueHastaMasReciente(r[n],i),this._cacheHitCuenta++,cacheEstado.HIT):(this.agregarBloqueASet(r[n],i),this._cacheMissCuenta++,cacheEstado.MISS),a+=this.obtenerFilaCacheActual(r,n,t[e],i,e,s);return a+="</table>"},t.prototype.encontrarCantidadDeBitsNecesarias=function(t){for(var e=0,o=0;o<t.length;o++)t[o]>e&&(e=t[o]);return e.toString(2).length},t.prototype.rellenarBinCerosYDividir=function(t,e){for(var o,i,r=t.toString(2),n="",a="",s="";r.length<e;)r="0"+r;for(i=0,o=r.length-1;i<this.bitsOffset;i++,o--)s=null==r[o]?"0"+s:r[o]+s;for(i=0;i<this.bitsIndice;i++,o--)a=null==r[o]?"0"+a:r[o]+a;for(;-1<o;o--)n=null==r[o]?"0"+n:r[o]+n;return(n=0==n.length?"0000":n)+"&nbsp;"+a+"&nbsp;"+s},t.prototype.obtenerFilaCacheActual=function(t,e,o,i,r,n){var a,s,c=e==cacheEstado.HIT?'<tr class="hit"><td>H</td>':'<tr class="miss"><td>M</td>';for(c+="<td>"+(r+1)+"</td>",c+="<td>"+o+"</td>",c+="<td>"+this.rellenarBinCerosYDividir(o,n)+"</td>",c+="<td>"+i+"</td>",a=0;a<this.numSets;a++){for(c+="<td>",s=0;s<this._setSize;s++)-1!=t[a][s]&&(c+=t[a][s]+" ");c+="</td>"}return c+="</tr>"},t.prototype.correrBloqueHastaMasReciente=function(t,e){for(var o=this.cuantosBloquesTieneSet(t),i=0;;){if(t[i]==e)break;i++}for(;i<o-1;i++)t[i]=t[i+1];t[o-1]=e},t.prototype.cuantosBloquesTieneSet=function(t){for(var e=0,o=0;o<this._setSize&&-1!=t[o];o++)e++;return e},t.prototype.agregarBloqueASet=function(t,e){var o=this.cuantosBloquesTieneSet(t);if(o<this._setSize)t[o]=e;else switch(this._algoritmoReemplazo){case algoritmoReemplazo.LRU:for(var i=0;i<this._setSize-1;i++)t[i]=t[i+1];t[this._setSize-1]=e;break;case algoritmoReemplazo.MRU:t[this._setSize-1]=e;break;case algoritmoReemplazo.RANDOM:t[Math.floor(Math.random()*this._setSize)]=e}},t.prototype.bloqueEstaEnSet=function(t,e){for(var o=0;o<this._setSize;o++)if(t[o]==e)return!0;return!1},t}();function setRandomExample(){for(var t=Array(30),e=0;e<t.length;e++)t[e]=Math.ceil(100*Math.random());$("#textarea_direcciones").val(t.join(", ")),procesarDirecciones()}function isPowerOfTwo(t){for(;t%2==0&&1<t;)t/=2;return 1==t}function numeroCorrecto(t){if(isPowerOfTwo(t))return!0}function mostrarError(t){$("#span_error").text(t)}function procesarDirecciones(){var t,e;validarConfiguracion()&&(null!=(t=crearArregloDirecciones())?(cache.configurar(blocksize,nblocks,nvias,algoritmo,tipoAsociatividad,addressing),e=cache.procesarDirecciones(t),$("#textarea_codigomars").html(transpiladorMips.obtenerCodigoMips(t,addressing)),$("#tablaCacheResultado").html(e),$("#hitMissRate").html("<p>Hits: <b>"+cache.hitCount+"</b></p><p>Miss: <b>"+cache.missCount+"</b></p><p>Hit rate: <b>"+cache.hitRate+"%</b></p>"),$("#bitsDireccion").html("<p>Index bits: <b>"+cache.bitsIndice+"</b></p><p>Offset bits: <b>"+cache.bitsOffset+"</b></p>"),$("#todosResultados").show()):mostrarError("Enter addresses correctly."))}function crearArregloDirecciones(){var t,e,o,i=$("#textarea_direcciones").val().toString().replace(/[^0-9]+/g," ");if(0==(i=i.trim()).length)return null;for(e=i.split(" "),t=new Array(e.length),o=0;o<e.length;o++)t[o]=Number(e[o]);return t}function validarConfiguracion(){var t=Number($("#config_blocksize").val()),e=Number($("#config_nblocks").val()),o=Number($("#config_nvias").val()),i=$("#config_tipoasociatividad").val().toString(),r=$("#config_algoritmo").val().toString(),n=$("#config_addressing").val().toString();return e<o&&($("#config_nvias").val(e.toString()),o=e),numeroCorrecto(t)?numeroCorrecto(e)?"sa"!=tipoAsociatividad||numeroCorrecto(o)?"md"!=i&&"sa"!=i&&"fa"!=i?(mostrarError("Incorrect associativity."),!1):"lru"!=r&&"mru"!=r&&"random"!=r?(mostrarError("Incorrect algorithm."),!1):"w"!=n&&"b"!=n?(mostrarError("Incorrect addressing type."),!1):(blocksize=t,nblocks=e,nvias=o,algoritmo=r,addressing=n,"md"==(tipoAsociatividad=i)?($("#config_nvias").prop("disabled",!0),$("#config_algoritmo").prop("disabled",!0),nvias=1):"sa"==tipoAsociatividad?($("#config_nvias").prop("disabled",!1),$("#config_algoritmo").prop("disabled",!1)):"fa"==tipoAsociatividad&&($("#config_nvias").prop("disabled",!0),$("#config_algoritmo").prop("disabled",!1),nvias=nblocks),$("#config_nvias").val(nvias.toString()),$("#info_nsets").text((nblocks/nvias).toString()),$("#info_cachesize").text(nblocks*blocksize*4+" bytes ("+nblocks*blocksize+" words)"),mostrarError(""),!0):(mostrarError("Number of ways is incorrect. It must be a power of 2 integer."),!1):(mostrarError("Number of blocks is incorrect. It must be a power of 2 integer."),!1):(mostrarError("Block size is incorrect. It must be a power of 2 integer."),!1)}!function(t){function n(t){return"0x"+t.toString(16)}t.hexEncode=n,t.obtenerCodigoMips=function(t,e){var o,i=268697600,r="";if("b"==e)for(o=0;o<t.length;o++)r+="lb $t0, "+n(i+t[o])+"\n";else for(o=0;o<t.length;o++)r+="lw $t0, "+n(i+4*t[o])+"\n";return $("#tablaCacheResultado").html(r),r}}(transpiladorMips=transpiladorMips||{}),$(document).ready(function(){$("#config_blocksize").val(4..toString()),$("#config_nblocks").val(16..toString()),$("#config_nvias").val(4..toString()),validarConfiguracion(),cache=new CacheSimulator,$("#btn_procesar").click(procesarDirecciones),$("#btn_random").click(setRandomExample),setRandomExample()});
//# sourceMappingURL=compiled.js.map
