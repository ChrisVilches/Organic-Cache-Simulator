"use strict";function isPowerOfTwo(t){for(;t%2==0&&t>1;)t/=2;return 1==t}function numeroCorrecto(t){return isPowerOfTwo(t)?!0:void 0}function mostrarError(t){$("#span_error").text(t)}function procesarDirecciones(){var t,e;if(validarConfiguracion()){if(t=crearArregloDirecciones(),null==t)return void mostrarError("Ingresar direcciones correctamente");cache.configurar(blocksize,nblocks,nvias,algoritmo,tipoAsociatividad,addressing),e=cache.procesarDirecciones(t),$("#textarea_codigomars").html(transpiladorMips.obtenerCodigoMips(t,addressing)),$("#tablaCacheResultado").html(e),$("#hitMissRate").html("<p>Hits: <b>"+cache.hitCount+"</b></p><p>Miss: <b>"+cache.missCount+"</b></p><p>Hit rate: <b>"+cache.hitRate+"%</b></p>"),$("#bitsDireccion").html("<p>Bits indice: <b>"+cache.bitsIndice+"</b></p><p>Bits offset: <b>"+cache.bitsOffset+"</b></p>"),$("#todosResultados").show()}}function crearArregloDirecciones(){var t,e,o,i=$("#textarea_direcciones").val().replace(/[^0-9]+/g," ");if(i=i.trim(),0==i.length)return null;for(e=i.split(" "),t=new Array(e.length),o=0;o<e.length;o++)t[o]=Number(e[o]);return t}function validarConfiguracion(){var t=Number($("#config_blocksize").val()),e=Number($("#config_nblocks").val()),o=Number($("#config_nvias").val()),i=$("#config_tipoasociatividad").val(),r=$("#config_algoritmo").val(),n=$("#config_addressing").val();return o>e&&($("#config_nvias").val(e.toString()),o=e),numeroCorrecto(t)?numeroCorrecto(e)?"sa"!=tipoAsociatividad||numeroCorrecto(o)?"md"!=i&&"sa"!=i&&"fa"!=i?(mostrarError("Asociatividad incorrecta."),!1):"lru"!=r&&"mru"!=r&&"random"!=r?(mostrarError("Algoritmo incorrecto."),!1):"w"!=n&&"b"!=n?(mostrarError("Tipo de addressing incorrecto."),!1):(blocksize=t,nblocks=e,nvias=o,tipoAsociatividad=i,algoritmo=r,addressing=n,"md"==tipoAsociatividad?($("#config_nvias").prop("disabled",!0),$("#config_algoritmo").prop("disabled",!0),nvias=1):"sa"==tipoAsociatividad?($("#config_nvias").prop("disabled",!1),$("#config_algoritmo").prop("disabled",!1)):"fa"==tipoAsociatividad&&($("#config_nvias").prop("disabled",!0),$("#config_algoritmo").prop("disabled",!1),nvias=nblocks),$("#config_nvias").val(nvias.toString()),$("#info_nsets").text((nblocks/nvias).toString()),$("#info_cachesize").text(nblocks*blocksize*4+" bytes ("+nblocks*blocksize+" palabras)"),mostrarError(""),!0):(mostrarError("Numero de vias no es correcto. Debe ser numero entero, potencia de 2."),!1):(mostrarError("Numero de bloques no es correcto. Debe ser numero entero, potencia de 2."),!1):(mostrarError("Tama√±o de bloque no es correcto. Debe ser numero entero, potencia de 2."),!1)}var algoritmoReemplazo;!function(t){t[t.LRU=0]="LRU",t[t.MRU=1]="MRU",t[t.RANDOM=2]="RANDOM"}(algoritmoReemplazo||(algoritmoReemplazo={}));var tipoDireccion;!function(t){t[t.BYTE=0]="BYTE",t[t.WORD=1]="WORD"}(tipoDireccion||(tipoDireccion={}));var cacheEstado;!function(t){t[t.HIT=0]="HIT",t[t.MISS=1]="MISS"}(cacheEstado||(cacheEstado={}));var Cache=function(){function t(){}return Object.defineProperty(t.prototype,"hitCount",{get:function(){return this._cacheHitCuenta},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"missCount",{get:function(){return this._cacheMissCuenta},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hitRate",{get:function(){var t,e;return t=this.hitCount+this.missCount,e=this.hitCount/t,Math.round(1e4*e)/100},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numSets",{get:function(){return this._nBlocks/this._setSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"offsetTotal",{get:function(){return this._tipoDireccion==tipoDireccion.BYTE?4*this._blockSize:this._blockSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bitsOffset",{get:function(){return this.offsetTotal.toString(2).length-1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bitsIndice",{get:function(){return this.numSets.toString(2).length-1},enumerable:!0,configurable:!0}),t.prototype.configurar=function(t,e,o,i,r,n){this._blockSize=t,this._nBlocks=e,"lru"==i?this._algoritmoReemplazo=algoritmoReemplazo.LRU:"mru"==i?this._algoritmoReemplazo=algoritmoReemplazo.MRU:"random"==i&&(this._algoritmoReemplazo=algoritmoReemplazo.RANDOM),"b"==n?this._tipoDireccion=tipoDireccion.BYTE:this._tipoDireccion=tipoDireccion.WORD,"md"==r?this._setSize=1:"sa"==r?this._setSize=o:"fa"==r&&(this._setSize=this._nBlocks)},t.prototype.procesarDirecciones=function(t){var e,o,i,r,n,a,s,c="",l=this.encontrarCantidadDeBitsNecesarias(t);for(this._cacheHitCuenta=0,this._cacheMissCuenta=0,n=new Array(this.numSets),e=0;e<this.numSets;e++)n[e]=new Array(this._setSize);for(e=0;e<this.numSets;e++)for(o=0;o<this._setSize;o++)n[e][o]=-1;for(c='<table class="tablaCacheHitMiss">',c+="<tr>",c+='<th class="noset"> </th>',c+='<th class="noset">#</th>',c+='<th class="noset">direccion</th>',c+='<th class="noset">binario <small>(tag indice offset)</small</th>',c+='<th class="noset">bloque #</th>',e=0;e<this.numSets;e++)c+="<th>set "+e+"</th>";for(c+="</tr>",e=0;e<t.length;e++)a=t[e],i=Math.floor(a/this.offsetTotal),r=i%this.numSets,this.bloqueEstaEnSet(n[r],i)?(this.correrBloqueHastaMasReciente(n[r],i),this._cacheHitCuenta++,s=cacheEstado.HIT):(this.agregarBloqueASet(n[r],i),this._cacheMissCuenta++,s=cacheEstado.MISS),c+=this.obtenerFilaCacheActual(n,s,t[e],i,e,l);return c+="</table>"},t.prototype.encontrarCantidadDeBitsNecesarias=function(t){var e,o=0;for(e=0;e<t.length;e++)t[e]>o&&(o=t[e]);return o.toString(2).length},t.prototype.rellenarBinCerosYDividir=function(t,e){for(var o,i,r=t.toString(2),n="",a="",s="";r.length<e;)r="0"+r;for(i=0,o=r.length-1;i<this.bitsOffset;i++,o--)s=void 0==r[o]?"0"+s:r[o]+s;for(i=0;i<this.bitsIndice;i++,o--)a=void 0==r[o]?"0"+a:r[o]+a;for(;o>-1;o--)n=void 0==r[o]?"0"+n:r[o]+n;return 0==n.length&&(n="0000"),n+"&nbsp;"+a+"&nbsp;"+s},t.prototype.obtenerFilaCacheActual=function(t,e,o,i,r,n){var a,s,c;for(c=e==cacheEstado.HIT?'<tr class="hit"><td>H</td>':'<tr class="miss"><td>M</td>',c+="<td>"+(r+1)+"</td>",c+="<td>"+o+"</td>",c+="<td>"+this.rellenarBinCerosYDividir(o,n)+"</td>",c+="<td>"+i+"</td>",a=0;a<this.numSets;a++){for(c+="<td>",s=0;s<this._setSize;s++)-1!=t[a][s]&&(c+=t[a][s]+" ");c+="</td>"}return c+="</tr>"},t.prototype.correrBloqueHastaMasReciente=function(t,e){var o,i=this.cuantosBloquesTieneSet(t);for(o=0;;){if(t[o]==e)break;o++}for(;i-1>o;o++)t[o]=t[o+1];t[i-1]=e},t.prototype.cuantosBloquesTieneSet=function(t){var e,o;for(e=0,o=0;o<this._setSize&&-1!=t[o];o++)e++;return e},t.prototype.agregarBloqueASet=function(t,e){var o=this.cuantosBloquesTieneSet(t);if(o<this._setSize)return void(t[o]=e);switch(this._algoritmoReemplazo){case algoritmoReemplazo.LRU:var i;for(i=0;i<this._setSize-1;i++)t[i]=t[i+1];t[this._setSize-1]=e;break;case algoritmoReemplazo.MRU:t[this._setSize-1]=e;break;case algoritmoReemplazo.RANDOM:var r=Math.floor(Math.random()*this._setSize);t[r]=e}},t.prototype.bloqueEstaEnSet=function(t,e){var o;for(o=0;o<this._setSize;o++)if(t[o]==e)return!0;return!1},t}(),transpiladorMips;!function(t){function e(t){return"0x"+t.toString(16)}function o(t,o){var i,r=268697600,n="";if("b"==o)for(i=0;i<t.length;i++)n+="lb $t0, "+e(r+t[i])+"\n";else for(i=0;i<t.length;i++)n+="lw $t0, "+e(r+4*t[i])+"\n";return $("#tablaCacheResultado").html(n),n}t.hexEncode=e,t.obtenerCodigoMips=o}(transpiladorMips||(transpiladorMips={}));var blocksize,nblocks,nvias,algoritmo,tipoAsociatividad,addressing,cache;$(document).ready(function(){document.title="Organic Cache Simulator",$("#config_blocksize").val(4..toString()),$("#config_nblocks").val(16..toString()),$("#config_nvias").val(4..toString()),validarConfiguracion(),cache=new Cache,$("#btn_procesar").click(function(){procesarDirecciones()})});
//# sourceMappingURL=compiled.js.map
